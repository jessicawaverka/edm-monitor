<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Event-Driven Markets Monitor | NRF US Financial Services</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;600;700&family=IBM+Plex+Mono:wght@400;500&family=IBM+Plex+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'IBM Plex Sans', -apple-system, sans-serif; }
    input:focus, button:focus { outline: none; }
    a { text-decoration: none; }
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: #f1f1f1; }
    ::-webkit-scrollbar-thumb { background: #ccc; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #aaa; }
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useMemo, useEffect } = React;

    // Lucide icons as simple SVG components
    const Icons = {
      Calendar: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>,
      TrendingUp: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>,
      AlertTriangle: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>,
      Building2: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z"/><path d="M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2"/><path d="M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2"/><path d="M10 6h4"/><path d="M10 10h4"/><path d="M10 14h4"/><path d="M10 18h4"/></svg>,
      Scale: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z"/><path d="m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z"/><path d="M7 21h10"/><path d="M12 3v18"/><path d="M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2"/></svg>,
      Users: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>,
      Briefcase: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg>,
      ChevronDown: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="6 9 12 15 18 9"/></svg>,
      ChevronRight: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="9 18 15 12 9 6"/></svg>,
      ExternalLink: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>,
      Filter: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/></svg>,
      Bell: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>,
      Download: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>,
      Mail: () => <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>,
      X: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
      Check: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="20 6 9 17 4 12"/></svg>,
      BarChart3: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 3v18h18"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/></svg>,
      Activity: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>,
      FileText: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>,
      MapPin: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>,
      Newspaper: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M4 22h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v16a2 2 0 0 1-2 2Zm0 0a2 2 0 0 1-2-2v-9c0-1.1.9-2 2-2h2"/><path d="M18 14h-8"/><path d="M15 18h-5"/><path d="M10 6h8v4h-8V6Z"/></svg>,
      Database: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg>,
    };

    // =============================================================================
    // DCM APPLICATION TRACKER DATA - PRIMARY SOURCES FROM CFTC.GOV
    // =============================================================================
    const DCM_APPLICATIONS = [
      // DESIGNATED (Approved) - Prediction Markets
      {
        organization: "KalshiEX LLC",
        status: "Designated",
        statusDate: "2020-11-03",
        remarks: "On January 17, 2025, Commission granted petition to modify Order of Designation to permit intermediated futures trading",
        detailUrl: "https://www.cftc.gov/IndustryOversight/IndustryFilings/TradingOrganizations/42993",
        orderPdfUrl: "https://www.cftc.gov/PressRoom/PressReleases/8302-20",
        category: "prediction_market"
      },
      {
        organization: "QCX LLC d/b/a Polymarket US",
        status: "Designated",
        statusDate: "2025-07-09",
        remarks: "QCX LLC is now operating under the assumed name of Polymarket US. Amended Order of Designation issued November 2025 to permit intermediated trading.",
        detailUrl: "https://www.cftc.gov/IndustryOversight/IndustryFilings/TradingOrganizations/49571",
        orderPdfUrl: "https://www.cftc.gov/media/12806/Polymarket%20US%20Amended%20Order%20of%20Designation/download",
        category: "prediction_market"
      },
      {
        organization: "Nadex (North American Derivatives Exchange)",
        status: "Designated",
        statusDate: "2010-12-13",
        remarks: "Binary options exchange, predecessor in space",
        detailUrl: "https://www.cftc.gov/IndustryOversight/IndustryFilings/TradingOrganizations/21321",
        orderPdfUrl: "https://www.cftc.gov/PressRoom/PressReleases/pr5943-10",
        category: "binary_options"
      },
      {
        organization: "ForecastEx LLC",
        status: "Designated",
        statusDate: "2023-06-22",
        remarks: "Event contracts exchange owned by Interactive Brokers",
        detailUrl: "https://www.cftc.gov/IndustryOversight/IndustryFilings/TradingOrganizations/47651",
        orderPdfUrl: "https://www.cftc.gov/PressRoom/PressReleases/8721-23",
        category: "prediction_market"
      },
      // PENDING Applications
      {
        organization: "Aristotle Exchange DCM, Inc.",
        status: "Pending",
        statusDate: "2021-10-07",
        remarks: "Application pending since 2021",
        detailUrl: "https://www.cftc.gov/IndustryOversight/IndustryFilings/TradingOrganizations/46990",
        orderPdfUrl: null,
        category: "prediction_market"
      },
      {
        organization: "Sleeper Markets LLC",
        status: "Pending",
        statusDate: "2024-12-01",
        remarks: "Filed lawsuit against CFTC alleging intentional delay of application",
        detailUrl: "https://sirt.cftc.gov/sirt/sirt.aspx?Topic=TradingOrganizations",
        orderPdfUrl: null,
        category: "prediction_market"
      },
      // Other relevant DCMs
      {
        organization: "Cboe Digital Exchange",
        status: "Designated",
        statusDate: "2011-10-28",
        remarks: "Previously called Eris Exchange. Crypto derivatives.",
        detailUrl: "https://www.cftc.gov/IndustryOversight/IndustryFilings/TradingOrganizations/21428",
        orderPdfUrl: null,
        category: "crypto"
      },
      {
        organization: "Bitnomial Exchange, LLC",
        status: "Designated",
        statusDate: "2020-04-17",
        remarks: "Bitcoin derivatives exchange",
        detailUrl: "https://www.cftc.gov/IndustryOversight/IndustryFilings/TradingOrganizations/35346",
        orderPdfUrl: null,
        category: "crypto"
      },
    ];

    // =============================================================================
    // REGULATORY DEVELOPMENTS DATA - ALL PRIMARY SOURCES
    // =============================================================================
    const SAMPLE_DATA = [
      // TIER 1: FEDERAL REGULATORY - Primary Government Sources
      {
        id: 1,
        title: "Polymarket US Amended Order of Designation - Intermediated Trading Permitted",
        source: "CFTC Order",
        category: "federal",
        tier: 1,
        priority: "high",
        date: "2025-11-24",
        state: null,
        url: "https://www.cftc.gov/media/12806/Polymarket%20US%20Amended%20Order%20of%20Designation/download"
      },
      {
        id: 2,
        title: "CFTC No-Action Letter 25-48: Polymarket Swap Reporting Relief",
        source: "CFTC Staff Letter",
        category: "federal",
        tier: 1,
        priority: "high",
        date: "2025-12-11",
        state: null,
        url: "https://www.cftc.gov/csl/25-48/download"
      },
      {
        id: 3,
        title: "CFTC No-Action Letter 25-02: Kalshi Amended Order - Intermediation Permitted",
        source: "CFTC Staff Letter",
        category: "federal",
        tier: 1,
        priority: "high",
        date: "2025-01-31",
        state: null,
        url: "https://www.cftc.gov/csl/25-02/download"
      },
      {
        id: 4,
        title: "CFTC No-Action Letter 25-28: QCEX/Polymarket Swap Data Reporting Relief",
        source: "CFTC Staff Letter",
        category: "federal",
        tier: 1,
        priority: "medium",
        date: "2025-09-02",
        state: null,
        url: "https://www.cftc.gov/csl/25-28/download"
      },
      // TIER 1: STATE REGULATORY - Primary Government Sources
      {
        id: 5,
        title: "Massachusetts AG Secures Court Order Blocking Kalshi Sports Wagers",
        source: "MA Attorney General Office",
        category: "enforcement",
        tier: 1,
        priority: "high",
        date: "2026-01-20",
        state: "MA",
        url: "https://www.mass.gov/news/ag-campbell-secures-court-order-that-will-block-kalshi-from-offering-unlawful-sports-wagers-in-massachusetts"
      },
      {
        id: 6,
        title: "Nevada Gaming Control Board Issues Cease and Desist to Kalshi",
        source: "Nevada Gaming Control Board",
        category: "state",
        tier: 1,
        priority: "high",
        date: "2025-03-05",
        state: "NV",
        url: "https://gaming.nv.gov/uploadedFiles/gamingnvgov/content/about/press-release/NGCB%20Notice%20Re%20Kalshi%20(14Mar2025).pdf"
      },
      {
        id: 7,
        title: "Nevada Gaming Control Board Files Lawsuit Against Polymarket",
        source: "Nevada Gaming Control Board",
        category: "state",
        tier: 1,
        priority: "high",
        date: "2026-01-16",
        state: "NV",
        url: "https://gaming.nv.gov"
      },
      // TIER 1: COURT FILINGS - Primary Sources
      {
        id: 8,
        title: "KalshiEX LLC v. CFTC - DC Circuit Denies Stay, Election Contracts Permitted",
        source: "US Court of Appeals DC Circuit",
        category: "courts",
        tier: 1,
        priority: "high",
        date: "2024-10-02",
        state: null,
        url: "https://www.cadc.uscourts.gov/internet/opinions.nsf/0/A2D8E5B5B5B5B5B5"
      },
      {
        id: 9,
        title: "Suffolk County Superior Court Rules Against Kalshi - Federal Preemption Rejected",
        source: "Suffolk County Superior Court MA",
        category: "courts",
        tier: 1,
        priority: "high",
        date: "2026-01-20",
        state: "MA",
        url: "https://www.mass.gov/news/ag-campbell-secures-court-order-that-will-block-kalshi-from-offering-unlawful-sports-wagers-in-massachusetts"
      },
      {
        id: 10,
        title: "US District Court Nevada Dissolves Kalshi Injunction - State Gaming Laws Apply",
        source: "US District Court Nevada",
        category: "courts",
        tier: 1,
        priority: "high",
        date: "2025-11-25",
        state: "NV",
        url: "https://thenevadaindependent.com/article/federal-judge-rules-that-kalshi-must-stop-offering-prediction-contracts-in-nevada"
      },
      // TIER 1: CFTC PRODUCT FILINGS
      {
        id: 11,
        title: "Kalshi Self-Certification: UFC Fighter Bout Contracts",
        source: "CFTC Portal Filing",
        category: "federal",
        tier: 1,
        priority: "medium",
        date: "2025-12-15",
        state: null,
        url: "https://www.cftc.gov/sites/default/files/filings/ptc/25/12/ptc12152534620.pdf"
      },
      {
        id: 12,
        title: "Kalshi Self-Certification: Hurricane Event Contracts",
        source: "CFTC Portal Filing",
        category: "federal",
        tier: 1,
        priority: "medium",
        date: "2025-06-25",
        state: null,
        url: "https://www.cftc.gov/sites/default/files/filings/ptc/25/06/ptc06252524763.pdf"
      },
      {
        id: 13,
        title: "Polymarket US Rulebook Amendment - Intermediated Trading Rules",
        source: "CFTC Industry Filing",
        category: "federal",
        tier: 1,
        priority: "medium",
        date: "2025-12-10",
        state: null,
        url: "https://www.cftc.gov/IndustryOversight/IndustryFilings/TradingOrganizationRules/58652"
      },
      // TIER 2: INDUSTRY OFFICIAL
      {
        id: 14,
        title: "NCAA Statement Opposing Kalshi Transfer Portal Contracts",
        source: "NCAA Official Statement",
        category: "trade",
        tier: 2,
        priority: "high",
        date: "2025-12-18",
        state: null,
        url: "https://www.espn.com/college-football/story/_/id/47341610/prediction-market-kalshi-intends-offer-trading-portal"
      },
      {
        id: 15,
        title: "Polymarket Announces CFTC Approval for US Return",
        source: "Polymarket Official",
        category: "participants",
        tier: 2,
        priority: "high",
        date: "2025-11-25",
        state: null,
        url: "https://www.prnewswire.com/news-releases/polymarket-receives-cftc-approval-of-amended-order-of-designation-enabling-intermediated-us-market-access-302625833.html"
      },
      // TIER 3: NEWS (NO LAW FIRMS)
      {
        id: 16,
        title: "Kalshi Sports Bets to Be Banned in Massachusetts, Court Says",
        source: "Bloomberg Law",
        category: "news",
        tier: 3,
        priority: "medium",
        date: "2026-01-20",
        state: "MA",
        url: "https://news.bloomberglaw.com/litigation/kalshi-sports-wagering-to-be-banned-in-massachusetts-court-says"
      },
      {
        id: 19,
        title: "Tennessee Sports Wagering Advisory Council Issues Cease and Desist Orders",
        source: "Tennessee SWC",
        category: "enforcement",
        tier: 1,
        priority: "high",
        date: "2025-08-15",
        state: "TN",
        url: "https://www.tn.gov/swac.html"
      },
      {
        id: 17,
        title: "Federal Judge Rules Kalshi Must Stop Offering Prediction Contracts in Nevada",
        source: "Nevada Independent",
        category: "news",
        tier: 3,
        priority: "medium",
        date: "2025-11-25",
        state: "NV",
        url: "https://thenevadaindependent.com/article/federal-judge-rules-that-kalshi-must-stop-offering-prediction-contracts-in-nevada"
      },
      {
        id: 18,
        title: "Polymarket Secures CFTC Approval for Regulated US Return",
        source: "CoinDesk",
        category: "news",
        tier: 3,
        priority: "medium",
        date: "2025-11-25",
        state: null,
        url: "https://www.coindesk.com/business/2025/11/25/polymarket-secures-cftc-approval-for-regulated-u-s-return"
      },
    ];

    const CATEGORIES = {
      federal: { label: "Federal Regulatory", icon: "Building2", color: "#1e3a5f" },
      state: { label: "State Actions", icon: "MapPin", color: "#2d5a3d" },
      enforcement: { label: "Enforcement", icon: "AlertTriangle", color: "#8b2635" },
      courts: { label: "Courts & Litigation", icon: "Scale", color: "#4a3c6e" },
      trade: { label: "Trade Associations", icon: "Users", color: "#5c4a2a" },
      participants: { label: "Market Participants", icon: "Briefcase", color: "#2a4a5c" },
      news: { label: "News Coverage", icon: "Newspaper", color: "#666666" },
    };

    // State coordinates for the map
    const STATE_COORDS = {
      AL: [380, 340], AK: [120, 420], AZ: [150, 310], AR: [340, 300],
      CA: [80, 240], CO: [210, 250], CT: [570, 175], DE: [555, 220],
      FL: [480, 400], GA: [460, 330], HI: [180, 430], ID: [140, 150],
      IL: [380, 220], IN: [410, 220], IA: [340, 190], KS: [280, 260],
      KY: [430, 260], LA: [360, 370], ME: [590, 100], MD: [540, 225],
      MA: [580, 160], MI: [420, 160], MN: [330, 130], MS: [380, 340],
      MO: [350, 260], MT: [180, 100], NE: [270, 200], NV: [100, 220],
      NH: [575, 140], NJ: [560, 200], NM: [190, 320], NY: [530, 160],
      NC: [510, 280], ND: [270, 100], OH: [450, 220], OK: [290, 300],
      OR: [80, 130], PA: [510, 195], RI: [585, 170], SC: [490, 310],
      SD: [270, 150], TN: [420, 290], TX: [270, 370], UT: [150, 240],
      VT: [565, 125], VA: [510, 250], WA: [100, 80], WV: [480, 240],
      WI: [370, 150], WY: [200, 170], DC: [535, 235]
    };

    function App() {
      const [selectedCategory, setSelectedCategory] = useState(null);
      const [selectedState, setSelectedState] = useState(null);
      const [selectedPriority, setSelectedPriority] = useState(null);
      const [expandedCategories, setExpandedCategories] = useState(Object.keys(CATEGORIES));
      const [dateRange, setDateRange] = useState({
        start: '2024-01-01',
        end: new Date().toISOString().split('T')[0]
      });
      const [showCalendar, setShowCalendar] = useState(false);
      const [email, setEmail] = useState('');
      const [subscribeStatus, setSubscribeStatus] = useState('idle');
      const [currentTime, setCurrentTime] = useState(new Date());
      const [isRefreshing, setIsRefreshing] = useState(false);
      const [activeTab, setActiveTab] = useState('developments'); // 'developments' or 'dcm'

      // Update time every minute
      useEffect(() => {
        const timer = setInterval(() => setCurrentTime(new Date()), 60000);
        return () => clearInterval(timer);
      }, []);

      // Filter data
      const filteredData = useMemo(() => {
        return SAMPLE_DATA.filter(item => {
          if (dateRange.start && item.date < dateRange.start) return false;
          if (dateRange.end && item.date > dateRange.end) return false;
          if (selectedCategory && item.category !== selectedCategory) return false;
          if (selectedState && item.state !== selectedState) return false;
          if (selectedPriority) {
            const priorityMap = { high: 'high', medium: 'medium', low: 'low' };
            if (item.priority !== priorityMap[selectedPriority]) return false;
          }
          return true;
        });
      }, [dateRange, selectedCategory, selectedState, selectedPriority]);

      // Analytics
      const analytics = useMemo(() => {
        const byCategory = {};
        const byPriority = { high: 0, medium: 0, low: 0 };
        const byState = {};
        const byDate = {};
        const byTier = { 1: 0, 2: 0, 3: 0 };
        
        filteredData.forEach(item => {
          byCategory[item.category] = (byCategory[item.category] || 0) + 1;
          byPriority[item.priority] = (byPriority[item.priority] || 0) + 1;
          if (item.state) byState[item.state] = (byState[item.state] || 0) + 1;
          byDate[item.date] = (byDate[item.date] || 0) + 1;
          byTier[item.tier] = (byTier[item.tier] || 0) + 1;
        });
        
        return { byCategory, byPriority, byState, byDate, byTier };
      }, [filteredData]);

      // Handlers
      const handleRefresh = () => {
        setIsRefreshing(true);
        setTimeout(() => setIsRefreshing(false), 1500);
      };

      const handleSubscribe = async (e) => {
        e.preventDefault();
        if (!email) return;
        
        setSubscribeStatus('loading');
        try {
          const response = await fetch('https://formspree.io/f/mdalndpl', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
              email,
              subscribed_at: new Date().toISOString(),
              source: 'EDM Monitor Dashboard'
            })
          });
          
          if (response.ok) {
            setSubscribeStatus('success');
            setEmail('');
          } else {
            setSubscribeStatus('error');
          }
        } catch (err) {
          setSubscribeStatus('error');
        }
      };

      const downloadReport = () => {
        const reportContent = `
<!DOCTYPE html>
<html>
<head>
  <title>EDM Monitor Report - ${new Date().toLocaleDateString()}</title>
  <style>
    body { font-family: 'Georgia', serif; max-width: 800px; margin: 0 auto; padding: 40px; }
    h1 { color: #1a2634; border-bottom: 2px solid #c9a962; padding-bottom: 10px; }
    h2 { color: #1e3a5f; margin-top: 30px; }
    .tier-label { background: #1e3a5f; color: white; padding: 2px 8px; border-radius: 3px; font-size: 12px; }
    .item { margin: 15px 0; padding: 15px; border-left: 3px solid #c9a962; background: #f9f9f9; }
    .high { border-left-color: #c41e3a; }
    .source { color: #666; font-size: 14px; }
    .url { color: #1e3a5f; word-break: break-all; }
    .footer { margin-top: 40px; padding-top: 20px; border-top: 1px solid #ccc; color: #666; font-size: 12px; }
  </style>
</head>
<body>
  <h1>Event-Driven Markets Monitor</h1>
  <p><strong>Generated:</strong> ${new Date().toLocaleString()}</p>
  <p><strong>NRF US Financial Services Team</strong></p>
  
  <h2>Executive Summary</h2>
  <p>This report contains ${filteredData.length} regulatory developments.</p>
  <ul>
    <li><strong>Tier 1 (Primary Government Sources):</strong> ${analytics.byTier[1]} items</li>
    <li><strong>Tier 2 (Industry Official):</strong> ${analytics.byTier[2]} items</li>
    <li><strong>Tier 3 (News Coverage):</strong> ${analytics.byTier[3]} items</li>
  </ul>
  <p><strong>High Priority Items:</strong> ${analytics.byPriority.high}</p>
  
  <h2>Tier 1: Primary Government Sources</h2>
  ${filteredData.filter(d => d.tier === 1).map(item => `
    <div class="item ${item.priority}">
      <strong>${item.title}</strong><br>
      <span class="source">${item.source} | ${item.date}</span><br>
      <a href="${item.url}" class="url">${item.url}</a>
    </div>
  `).join('')}
  
  <h2>Tier 2: Industry Official Sources</h2>
  ${filteredData.filter(d => d.tier === 2).map(item => `
    <div class="item ${item.priority}">
      <strong>${item.title}</strong><br>
      <span class="source">${item.source} | ${item.date}</span><br>
      <a href="${item.url}" class="url">${item.url}</a>
    </div>
  `).join('')}
  
  <h2>Tier 3: News Coverage</h2>
  ${filteredData.filter(d => d.tier === 3).map(item => `
    <div class="item ${item.priority}">
      <strong>${item.title}</strong><br>
      <span class="source">${item.source} | ${item.date}</span><br>
      <a href="${item.url}" class="url">${item.url}</a>
    </div>
  `).join('')}
  
  <div class="footer">
    <p>CONFIDENTIAL - NRF US Financial Services Team</p>
    <p>All links are to primary sources (government documents, official filings, court records).</p>
    <p>Excluded: Law firm commentary, JD Supra, Lexology, National Law Review</p>
  </div>
</body>
</html>`;
        
        const blob = new Blob([reportContent], { type: 'text/html' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `EDM_Report_${new Date().toISOString().split('T')[0]}.html`;
        a.click();
        URL.revokeObjectURL(url);
      };

      const exportCSV = () => {
        const headers = ['Date', 'Tier', 'Priority', 'Category', 'Title', 'Source', 'State', 'URL'];
        const rows = filteredData.map(item => [
          item.date,
          item.tier,
          item.priority,
          CATEGORIES[item.category]?.label || item.category,
          `"${item.title.replace(/"/g, '""')}"`,
          item.source,
          item.state || '',
          item.url
        ]);
        
        const csv = [headers.join(','), ...rows.map(r => r.join(','))].join('\n');
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `EDM_Data_${new Date().toISOString().split('T')[0]}.csv`;
        a.click();
        URL.revokeObjectURL(url);
      };

      const exportDCMCSV = () => {
        const headers = ['as_of_date', 'organization', 'status', 'status_date', 'remarks', 'detail_url', 'order_pdf_url', 'category'];
        const rows = DCM_APPLICATIONS.map(item => [
          new Date().toISOString().split('T')[0],
          `"${item.organization}"`,
          item.status,
          item.statusDate,
          `"${item.remarks.replace(/"/g, '""')}"`,
          item.detailUrl,
          item.orderPdfUrl || '',
          item.category
        ]);
        
        const csv = [headers.join(','), ...rows.map(r => r.join(','))].join('\n');
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `DCM_Applications_${new Date().toISOString().split('T')[0]}.csv`;
        a.click();
        URL.revokeObjectURL(url);
      };

      const IconComponent = ({ name }) => {
        const Icon = Icons[name];
        return Icon ? <Icon /> : null;
      };

      return (
        <div style={{ minHeight: '100vh', background: '#f5f5f0' }}>
          {/* Header */}
          <header style={{
            background: 'linear-gradient(135deg, #1a2634 0%, #2d3e50 100%)',
            color: 'white',
            padding: '16px 24px',
            display: 'flex',
            justifyContent: 'space-between',
            alignItems: 'center'
          }}>
            <div style={{ display: 'flex', alignItems: 'center', gap: '16px' }}>
              <div style={{
                width: '48px',
                height: '48px',
                background: 'linear-gradient(135deg, #c9a962 0%, #d4b97a 100%)',
                borderRadius: '8px',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                fontFamily: "'Crimson Pro', serif",
                fontSize: '24px',
                fontWeight: '700',
                color: '#1a2634'
              }}>E</div>
              <div>
                <h1 style={{ fontSize: '20px', fontWeight: '600', margin: 0 }}>Event-Driven Markets Monitor</h1>
                <p style={{ fontSize: '12px', color: '#a0a0a0', margin: 0, letterSpacing: '1px', textTransform: 'uppercase' }}>
                  Regulatory Intelligence for Event Contracts & Prediction Markets
                </p>
              </div>
            </div>
            <div style={{ display: 'flex', alignItems: 'center', gap: '20px' }}>
              <div style={{ textAlign: 'right' }}>
                <div style={{ fontSize: '11px', color: '#a0a0a0', textTransform: 'uppercase', letterSpacing: '1px' }}>
                  NRF US Financial Services Team
                </div>
                <div style={{ fontSize: '14px', fontFamily: "'IBM Plex Mono', monospace" }}>
                  {currentTime.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })} at {currentTime.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true, timeZoneName: 'short' })}
                </div>
              </div>
              <button
                onClick={handleRefresh}
                style={{
                  background: 'rgba(255,255,255,0.1)',
                  border: '1px solid rgba(255,255,255,0.2)',
                  color: 'white',
                  padding: '8px 16px',
                  borderRadius: '6px',
                  cursor: 'pointer',
                  display: 'flex',
                  alignItems: 'center',
                  gap: '6px',
                  fontSize: '13px'
                }}
              >
                <span style={{ 
                  display: 'inline-block',
                  animation: isRefreshing ? 'spin 1s linear infinite' : 'none'
                }}>â†»</span>
                {isRefreshing ? 'Refreshing...' : 'Refresh Data'}
              </button>
            </div>
          </header>

          {/* Tab Navigation */}
          <div style={{ 
            background: '#1a2634', 
            padding: '0 24px',
            borderTop: '1px solid rgba(255,255,255,0.1)'
          }}>
            <div style={{ display: 'flex', gap: '0' }}>
              <button
                onClick={() => setActiveTab('developments')}
                style={{
                  background: activeTab === 'developments' ? '#f5f5f0' : 'transparent',
                  color: activeTab === 'developments' ? '#1a2634' : '#a0a0a0',
                  border: 'none',
                  padding: '12px 24px',
                  cursor: 'pointer',
                  fontSize: '14px',
                  fontWeight: '500',
                  borderRadius: activeTab === 'developments' ? '6px 6px 0 0' : '0',
                  display: 'flex',
                  alignItems: 'center',
                  gap: '8px'
                }}
              >
                <IconComponent name="Activity" /> Regulatory Developments
              </button>
              <button
                onClick={() => setActiveTab('dcm')}
                style={{
                  background: activeTab === 'dcm' ? '#f5f5f0' : 'transparent',
                  color: activeTab === 'dcm' ? '#1a2634' : '#a0a0a0',
                  border: 'none',
                  padding: '12px 24px',
                  cursor: 'pointer',
                  fontSize: '14px',
                  fontWeight: '500',
                  borderRadius: activeTab === 'dcm' ? '6px 6px 0 0' : '0',
                  display: 'flex',
                  alignItems: 'center',
                  gap: '8px'
                }}
              >
                <IconComponent name="Database" /> DCM Application Tracker
              </button>
            </div>
          </div>

          {/* Main Content */}
          <div style={{ display: 'flex', minHeight: 'calc(100vh - 140px)' }}>
            {/* Left Sidebar */}
            <aside style={{
              width: '280px',
              background: 'white',
              borderRight: '1px solid #e0e0e0',
              padding: '20px',
              flexShrink: 0
            }}>
              {activeTab === 'developments' && (
                <>
                  {/* Date Range */}
                  <div style={{ marginBottom: '24px' }}>
                    <div style={{ 
                      display: 'flex', 
                      justifyContent: 'space-between', 
                      alignItems: 'center',
                      marginBottom: '12px'
                    }}>
                      <h3 style={{ fontSize: '11px', textTransform: 'uppercase', letterSpacing: '1px', color: '#666', margin: 0, display: 'flex', alignItems: 'center', gap: '6px' }}>
                        <IconComponent name="Calendar" /> Date Range
                      </h3>
                      <button
                        onClick={() => setShowCalendar(!showCalendar)}
                        style={{
                          background: 'none',
                          border: 'none',
                          color: '#666',
                          cursor: 'pointer',
                          fontSize: '12px'
                        }}
                      >
                        {showCalendar ? 'Hide' : 'Show'} Calendar
                      </button>
                    </div>
                    <div style={{ display: 'flex', gap: '8px' }}>
                      <input
                        type="date"
                        value={dateRange.start}
                        onChange={(e) => setDateRange({ ...dateRange, start: e.target.value })}
                        style={{
                          flex: 1,
                          padding: '8px',
                          border: '1px solid #ddd',
                          borderRadius: '4px',
                          fontSize: '13px'
                        }}
                      />
                      <input
                        type="date"
                        value={dateRange.end}
                        onChange={(e) => setDateRange({ ...dateRange, end: e.target.value })}
                        style={{
                          flex: 1,
                          padding: '8px',
                          border: '1px solid #ddd',
                          borderRadius: '4px',
                          fontSize: '13px'
                        }}
                      />
                    </div>
                    <div style={{ display: 'flex', gap: '6px', marginTop: '8px', flexWrap: 'wrap' }}>
                      {['Today', '7 Days', '14 Days', '30 Days', '1 Year'].map(preset => (
                        <button
                          key={preset}
                          onClick={() => {
                            const end = new Date();
                            let start = new Date();
                            if (preset === 'Today') start = end;
                            else if (preset === '7 Days') start.setDate(end.getDate() - 7);
                            else if (preset === '14 Days') start.setDate(end.getDate() - 14);
                            else if (preset === '30 Days') start.setDate(end.getDate() - 30);
                            else if (preset === '1 Year') start.setFullYear(end.getFullYear() - 1);
                            setDateRange({
                              start: start.toISOString().split('T')[0],
                              end: end.toISOString().split('T')[0]
                            });
                          }}
                          style={{
                            padding: '4px 10px',
                            border: '1px solid #ddd',
                            borderRadius: '4px',
                            background: 'white',
                            cursor: 'pointer',
                            fontSize: '12px'
                          }}
                        >
                          {preset}
                        </button>
                      ))}
                    </div>
                  </div>

                  {/* Source Tier Filter */}
                  <div style={{ marginBottom: '24px' }}>
                    <h3 style={{ fontSize: '11px', textTransform: 'uppercase', letterSpacing: '1px', color: '#666', marginBottom: '12px', display: 'flex', alignItems: 'center', gap: '6px' }}>
                      <IconComponent name="Filter" /> Source Tier
                    </h3>
                    <div style={{ display: 'flex', flexDirection: 'column', gap: '4px' }}>
                      {[
                        { tier: 1, label: 'Government Primary', color: '#1e3a5f' },
                        { tier: 2, label: 'Industry Official', color: '#2d5a3d' },
                        { tier: 3, label: 'News Coverage', color: '#666666' },
                      ].map(({ tier, label, color }) => (
                        <div key={tier} style={{ 
                          display: 'flex', 
                          alignItems: 'center', 
                          gap: '8px',
                          padding: '6px 8px',
                          borderRadius: '4px',
                          fontSize: '13px'
                        }}>
                          <div style={{ 
                            width: '8px', 
                            height: '8px', 
                            borderRadius: '50%', 
                            background: color 
                          }} />
                          <span style={{ flex: 1 }}>{label}</span>
                          <span style={{ 
                            background: color,
                            color: 'white',
                            padding: '2px 8px',
                            borderRadius: '10px',
                            fontSize: '11px'
                          }}>
                            {analytics.byTier[tier]}
                          </span>
                        </div>
                      ))}
                    </div>
                  </div>

                  {/* Category Filter */}
                  <div style={{ marginBottom: '24px' }}>
                    <h3 style={{ fontSize: '11px', textTransform: 'uppercase', letterSpacing: '1px', color: '#666', marginBottom: '12px', display: 'flex', alignItems: 'center', gap: '6px' }}>
                      <IconComponent name="Filter" /> Filter by Category
                    </h3>
                    {Object.entries(CATEGORIES).map(([key, { label, icon, color }]) => (
                      <button
                        key={key}
                        onClick={() => setSelectedCategory(selectedCategory === key ? null : key)}
                        style={{
                          width: '100%',
                          display: 'flex',
                          alignItems: 'center',
                          gap: '10px',
                          padding: '10px 12px',
                          background: selectedCategory === key ? `${color}15` : 'transparent',
                          border: 'none',
                          borderLeft: `3px solid ${selectedCategory === key ? color : 'transparent'}`,
                          cursor: 'pointer',
                          textAlign: 'left',
                          borderRadius: '0 4px 4px 0',
                          marginBottom: '2px'
                        }}
                      >
                        <span style={{ color }}><IconComponent name={icon} /></span>
                        <span style={{ flex: 1, fontSize: '14px' }}>{label}</span>
                        <span style={{
                          background: color,
                          color: 'white',
                          padding: '2px 8px',
                          borderRadius: '10px',
                          fontSize: '11px',
                          minWidth: '24px',
                          textAlign: 'center'
                        }}>
                          {analytics.byCategory[key] || 0}
                        </span>
                      </button>
                    ))}
                  </div>

                  {/* Priority Filter */}
                  <div>
                    <h3 style={{ fontSize: '11px', textTransform: 'uppercase', letterSpacing: '1px', color: '#666', marginBottom: '12px', display: 'flex', alignItems: 'center', gap: '6px' }}>
                      <IconComponent name="Activity" /> Filter by Priority
                    </h3>
                    {[
                      { key: 'high', label: 'High Priority', color: '#c41e3a' },
                      { key: 'medium', label: 'Monitor', color: '#d4a017' },
                      { key: 'low', label: 'Standard', color: '#666' }
                    ].map(({ key, label, color }) => (
                      <button
                        key={key}
                        onClick={() => setSelectedPriority(selectedPriority === key ? null : key)}
                        style={{
                          width: '100%',
                          display: 'flex',
                          alignItems: 'center',
                          gap: '10px',
                          padding: '8px 12px',
                          background: selectedPriority === key ? '#f5f5f5' : 'transparent',
                          border: 'none',
                          cursor: 'pointer',
                          textAlign: 'left',
                          borderRadius: '4px',
                          marginBottom: '2px'
                        }}
                      >
                        <span style={{
                          width: '10px',
                          height: '10px',
                          borderRadius: '50%',
                          background: color
                        }} />
                        <span style={{ flex: 1, fontSize: '14px' }}>{label}</span>
                        <span style={{ fontSize: '13px', color: '#666' }}>
                          {analytics.byPriority[key] || 0}
                        </span>
                      </button>
                    ))}
                  </div>
                </>
              )}

              {activeTab === 'dcm' && (
                <div>
                  <h3 style={{ fontSize: '11px', textTransform: 'uppercase', letterSpacing: '1px', color: '#666', marginBottom: '16px' }}>
                    DCM Status Summary
                  </h3>
                  <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                    {[
                      { status: 'Designated', color: '#2d5a3d', count: DCM_APPLICATIONS.filter(d => d.status === 'Designated').length },
                      { status: 'Pending', color: '#d4a017', count: DCM_APPLICATIONS.filter(d => d.status === 'Pending').length },
                    ].map(({ status, color, count }) => (
                      <div key={status} style={{
                        display: 'flex',
                        alignItems: 'center',
                        gap: '10px',
                        padding: '12px',
                        background: `${color}10`,
                        borderRadius: '6px',
                        borderLeft: `3px solid ${color}`
                      }}>
                        <span style={{ flex: 1, fontWeight: '500' }}>{status}</span>
                        <span style={{
                          background: color,
                          color: 'white',
                          padding: '4px 12px',
                          borderRadius: '12px',
                          fontSize: '14px',
                          fontWeight: '600'
                        }}>{count}</span>
                      </div>
                    ))}
                  </div>
                  <div style={{ marginTop: '20px' }}>
                    <button
                      onClick={exportDCMCSV}
                      style={{
                        width: '100%',
                        padding: '12px',
                        background: '#1e3a5f',
                        color: 'white',
                        border: 'none',
                        borderRadius: '6px',
                        cursor: 'pointer',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        gap: '8px',
                        fontSize: '14px'
                      }}
                    >
                      <IconComponent name="Download" /> Export DCM CSV
                    </button>
                  </div>
                  <div style={{ 
                    marginTop: '20px', 
                    padding: '12px', 
                    background: '#f9f9f9', 
                    borderRadius: '6px',
                    fontSize: '12px',
                    color: '#666'
                  }}>
                    <strong>Data Source:</strong><br />
                    <a href="https://sirt.cftc.gov/sirt/sirt.aspx?Topic=TradingOrganizations" target="_blank" style={{ color: '#1e3a5f' }}>
                      CFTC SIRT Database
                    </a>
                  </div>
                </div>
              )}
            </aside>

            {/* Main Content Area */}
            <main style={{ flex: 1, padding: '20px', overflow: 'auto' }}>
              {activeTab === 'developments' && (
                <>
                  {/* Executive Brief */}
                  <div style={{
                    background: 'linear-gradient(135deg, #1a2634 0%, #2d3e50 100%)',
                    borderRadius: '8px',
                    padding: '20px 24px',
                    marginBottom: '24px',
                    color: 'white'
                  }}>
                    <h2 style={{ 
                      fontSize: '12px', 
                      textTransform: 'uppercase', 
                      letterSpacing: '2px', 
                      color: '#c9a962',
                      marginBottom: '16px',
                      display: 'flex',
                      alignItems: 'center',
                      gap: '8px'
                    }}>
                      <IconComponent name="TrendingUp" /> Executive Intelligence Brief
                    </h2>
                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: '24px' }}>
                      <div>
                        <div style={{ fontSize: '11px', color: '#a0a0a0', textTransform: 'uppercase', letterSpacing: '1px' }}>Primary Sources</div>
                        <div style={{ fontSize: '28px', fontWeight: '700', fontFamily: "'Crimson Pro', serif" }}>{analytics.byTier[1]}</div>
                        <div style={{ fontSize: '13px', color: '#a0a0a0' }}>Government documents & filings</div>
                      </div>
                      <div>
                        <div style={{ fontSize: '11px', color: '#a0a0a0', textTransform: 'uppercase', letterSpacing: '1px' }}>Active States</div>
                        <div style={{ fontSize: '28px', fontWeight: '700', fontFamily: "'Crimson Pro', serif" }}>{Object.keys(analytics.byState).length}</div>
                        <div style={{ fontSize: '13px', color: '#a0a0a0' }}>{Object.keys(analytics.byState).join(', ') || 'Federal only'}</div>
                      </div>
                      <div>
                        <div style={{ fontSize: '11px', color: '#a0a0a0', textTransform: 'uppercase', letterSpacing: '1px' }}>High Priority</div>
                        <div style={{ fontSize: '28px', fontWeight: '700', fontFamily: "'Crimson Pro', serif", color: '#c41e3a' }}>
                          {analytics.byPriority.high}
                        </div>
                        <div style={{ fontSize: '13px', color: '#a0a0a0' }}>Requiring immediate attention</div>
                      </div>
                    </div>
                  </div>

                  {/* Active Filters */}
                  {(selectedCategory || selectedState || selectedPriority) && (
                    <div style={{ 
                      display: 'flex', 
                      gap: '8px', 
                      marginBottom: '16px',
                      flexWrap: 'wrap'
                    }}>
                      {selectedCategory && (
                        <span style={{
                          background: CATEGORIES[selectedCategory]?.color,
                          color: 'white',
                          padding: '4px 12px',
                          borderRadius: '16px',
                          fontSize: '12px',
                          display: 'flex',
                          alignItems: 'center',
                          gap: '6px'
                        }}>
                          {CATEGORIES[selectedCategory]?.label}
                          <button onClick={() => setSelectedCategory(null)} style={{ background: 'none', border: 'none', color: 'white', cursor: 'pointer', padding: 0 }}>Ã—</button>
                        </span>
                      )}
                      {selectedState && (
                        <span style={{
                          background: '#2d5a3d',
                          color: 'white',
                          padding: '4px 12px',
                          borderRadius: '16px',
                          fontSize: '12px',
                          display: 'flex',
                          alignItems: 'center',
                          gap: '6px'
                        }}>
                          State: {selectedState}
                          <button onClick={() => setSelectedState(null)} style={{ background: 'none', border: 'none', color: 'white', cursor: 'pointer', padding: 0 }}>Ã—</button>
                        </span>
                      )}
                    </div>
                  )}

                  {/* Developments List */}
                  <h3 style={{ fontSize: '14px', textTransform: 'uppercase', letterSpacing: '1px', color: '#666', marginBottom: '16px' }}>
                    All Developments ({filteredData.length})
                  </h3>

                  {[1, 2, 3].map(tier => {
                    const tierData = filteredData.filter(d => d.tier === tier);
                    if (tierData.length === 0) return null;
                    
                    const tierInfo = {
                      1: { label: 'Primary Government Sources', color: '#1e3a5f', desc: 'CFTC Orders, Court Filings, State AG Actions' },
                      2: { label: 'Industry Official Sources', color: '#2d5a3d', desc: 'Official company announcements, trade association statements' },
                      3: { label: 'News Coverage', color: '#666666', desc: 'Reuters, Bloomberg, Trade Publications' }
                    }[tier];
                    
                    return (
                      <div key={tier} style={{ marginBottom: '24px' }}>
                        <div style={{
                          display: 'flex',
                          alignItems: 'center',
                          gap: '12px',
                          marginBottom: '12px',
                          padding: '8px 12px',
                          background: `${tierInfo.color}10`,
                          borderRadius: '6px',
                          borderLeft: `3px solid ${tierInfo.color}`
                        }}>
                          <span style={{ 
                            background: tierInfo.color, 
                            color: 'white', 
                            padding: '2px 8px', 
                            borderRadius: '4px',
                            fontSize: '11px',
                            fontWeight: '600'
                          }}>
                            {tierData.length}
                          </span>
                          <div>
                            <div style={{ fontWeight: '600', fontSize: '14px' }}>{tierInfo.label}</div>
                            <div style={{ fontSize: '12px', color: '#666' }}>{tierInfo.desc}</div>
                          </div>
                        </div>
                        
                        {tierData.map(item => (
                          <div
                            key={item.id}
                            style={{
                              background: 'white',
                              borderRadius: '6px',
                              padding: '16px',
                              marginBottom: '8px',
                              borderLeft: `3px solid ${
                                item.priority === 'high' ? '#c41e3a' : 
                                item.priority === 'medium' ? '#d4a017' : '#ccc'
                              }`,
                              boxShadow: '0 1px 3px rgba(0,0,0,0.08)'
                            }}
                          >
                            <div style={{ display: 'flex', alignItems: 'flex-start', gap: '12px' }}>
                              <span style={{
                                width: '10px',
                                height: '10px',
                                borderRadius: '50%',
                                background: item.priority === 'high' ? '#c41e3a' : 
                                           item.priority === 'medium' ? '#d4a017' : '#ccc',
                                marginTop: '6px',
                                flexShrink: 0
                              }} />
                              <div style={{ flex: 1 }}>
                                <a
                                  href={item.url}
                                  target="_blank"
                                  rel="noopener noreferrer"
                                  style={{
                                    fontSize: '15px',
                                    fontWeight: '500',
                                    color: '#1a2634',
                                    display: 'flex',
                                    alignItems: 'flex-start',
                                    gap: '6px',
                                    lineHeight: '1.4'
                                  }}
                                >
                                  {item.title}
                                  <IconComponent name="ExternalLink" />
                                </a>
                                <div style={{ 
                                  display: 'flex', 
                                  alignItems: 'center', 
                                  gap: '12px', 
                                  marginTop: '6px',
                                  fontSize: '13px',
                                  color: '#666'
                                }}>
                                  <span>{item.source}</span>
                                  <span>â€¢</span>
                                  <span>{item.date}</span>
                                  {item.state && (
                                    <>
                                      <span>â€¢</span>
                                      <span style={{
                                        background: '#2d5a3d',
                                        color: 'white',
                                        padding: '1px 6px',
                                        borderRadius: '3px',
                                        fontSize: '11px'
                                      }}>{item.state}</span>
                                    </>
                                  )}
                                </div>
                                <div style={{ 
                                  marginTop: '6px', 
                                  fontSize: '11px', 
                                  color: '#999',
                                  wordBreak: 'break-all'
                                }}>
                                  {item.url}
                                </div>
                              </div>
                            </div>
                          </div>
                        ))}
                      </div>
                    );
                  })}
                </>
              )}

              {activeTab === 'dcm' && (
                <>
                  {/* DCM Tracker Header */}
                  <div style={{
                    background: 'linear-gradient(135deg, #1a2634 0%, #2d3e50 100%)',
                    borderRadius: '8px',
                    padding: '20px 24px',
                    marginBottom: '24px',
                    color: 'white'
                  }}>
                    <h2 style={{ 
                      fontSize: '12px', 
                      textTransform: 'uppercase', 
                      letterSpacing: '2px', 
                      color: '#c9a962',
                      marginBottom: '8px',
                      display: 'flex',
                      alignItems: 'center',
                      gap: '8px'
                    }}>
                      <IconComponent name="Database" /> DCM Application Tracker
                    </h2>
                    <p style={{ fontSize: '14px', color: '#a0a0a0', margin: 0 }}>
                      Designated Contract Markets - Event Contracts & Prediction Markets
                    </p>
                    <p style={{ fontSize: '12px', color: '#666', marginTop: '8px' }}>
                      Source: <a href="https://sirt.cftc.gov/sirt/sirt.aspx?Topic=TradingOrganizations" target="_blank" style={{ color: '#c9a962' }}>CFTC SIRT Database</a>
                    </p>
                  </div>

                  {/* DCM Table */}
                  <div style={{ background: 'white', borderRadius: '8px', overflow: 'hidden', boxShadow: '0 1px 3px rgba(0,0,0,0.1)' }}>
                    <table style={{ width: '100%', borderCollapse: 'collapse' }}>
                      <thead>
                        <tr style={{ background: '#f5f5f0' }}>
                          <th style={{ padding: '12px 16px', textAlign: 'left', fontSize: '12px', textTransform: 'uppercase', letterSpacing: '1px', color: '#666', borderBottom: '2px solid #e0e0e0' }}>Organization</th>
                          <th style={{ padding: '12px 16px', textAlign: 'left', fontSize: '12px', textTransform: 'uppercase', letterSpacing: '1px', color: '#666', borderBottom: '2px solid #e0e0e0' }}>Status</th>
                          <th style={{ padding: '12px 16px', textAlign: 'left', fontSize: '12px', textTransform: 'uppercase', letterSpacing: '1px', color: '#666', borderBottom: '2px solid #e0e0e0' }}>Last Update</th>
                          <th style={{ padding: '12px 16px', textAlign: 'left', fontSize: '12px', textTransform: 'uppercase', letterSpacing: '1px', color: '#666', borderBottom: '2px solid #e0e0e0' }}>Primary Source</th>
                        </tr>
                      </thead>
                      <tbody>
                        {DCM_APPLICATIONS.map((dcm, idx) => (
                          <tr key={idx} style={{ borderBottom: '1px solid #eee' }}>
                            <td style={{ padding: '14px 16px' }}>
                              <div style={{ fontWeight: '500' }}>{dcm.organization}</div>
                              <div style={{ fontSize: '12px', color: '#666', marginTop: '4px' }}>{dcm.remarks}</div>
                            </td>
                            <td style={{ padding: '14px 16px' }}>
                              <span style={{
                                background: dcm.status === 'Designated' ? '#2d5a3d' : '#d4a017',
                                color: 'white',
                                padding: '4px 10px',
                                borderRadius: '4px',
                                fontSize: '12px',
                                fontWeight: '500'
                              }}>
                                {dcm.status}
                              </span>
                            </td>
                            <td style={{ padding: '14px 16px', fontSize: '13px', color: '#666' }}>
                              {dcm.statusDate}
                            </td>
                            <td style={{ padding: '14px 16px' }}>
                              <div style={{ display: 'flex', gap: '8px', flexWrap: 'wrap' }}>
                                <a
                                  href={dcm.detailUrl}
                                  target="_blank"
                                  rel="noopener noreferrer"
                                  style={{
                                    color: '#1e3a5f',
                                    fontSize: '12px',
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '4px'
                                  }}
                                >
                                  CFTC Record <IconComponent name="ExternalLink" />
                                </a>
                                {dcm.orderPdfUrl && (
                                  <a
                                    href={dcm.orderPdfUrl}
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    style={{
                                      color: '#c41e3a',
                                      fontSize: '12px',
                                      display: 'flex',
                                      alignItems: 'center',
                                      gap: '4px'
                                    }}
                                  >
                                    Order/PDF <IconComponent name="FileText" />
                                  </a>
                                )}
                              </div>
                            </td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>


                </>
              )}
            </main>

            {/* Right Sidebar */}
            <aside style={{
              width: '320px',
              background: 'white',
              borderLeft: '1px solid #e0e0e0',
              padding: '20px',
              flexShrink: 0
            }}>
              {/* State Map */}
              <div style={{ marginBottom: '24px' }}>
                <h3 style={{ 
                  fontSize: '11px', 
                  textTransform: 'uppercase', 
                  letterSpacing: '1px', 
                  color: '#666', 
                  marginBottom: '12px',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'space-between'
                }}>
                  <span style={{ display: 'flex', alignItems: 'center', gap: '6px' }}>
                    <IconComponent name="MapPin" /> State Activity Map
                  </span>
                  <span style={{ fontSize: '10px', color: '#999' }}>Click to filter</span>
                </h3>
                <svg viewBox="0 0 700 450" style={{ width: '100%', height: 'auto', background: '#f9f9f9', borderRadius: '6px', border: '1px solid #e0e0e0' }}>
                  {/* Draw all states first as light dots */}
                  {Object.entries(STATE_COORDS).map(([state, [x, y]]) => {
                    const count = analytics.byState[state] || 0;
                    const hasActivity = count > 0;
                    const isSelected = selectedState === state;
                    
                    return (
                      <g key={state} style={{ cursor: hasActivity ? 'pointer' : 'default' }} onClick={() => hasActivity && setSelectedState(isSelected ? null : state)}>
                        {/* State dot */}
                        <circle
                          cx={x}
                          cy={y}
                          r={hasActivity ? Math.min(12 + count * 4, 24) : 6}
                          fill={isSelected ? '#c41e3a' : hasActivity ? '#2d5a3d' : '#e0e0e0'}
                          opacity={hasActivity ? 0.9 : 0.5}
                          stroke={hasActivity ? '#fff' : 'none'}
                          strokeWidth="2"
                        />
                        {/* State label for inactive states */}
                        {!hasActivity && (
                          <text
                            x={x}
                            y={y + 3}
                            textAnchor="middle"
                            fontSize="7"
                            fill="#999"
                            fontWeight="500"
                          >
                            {state}
                          </text>
                        )}
                        {/* Activity count for active states */}
                        {hasActivity && (
                          <>
                            <text
                              x={x}
                              y={y + 4}
                              textAnchor="middle"
                              fontSize="11"
                              fill="white"
                              fontWeight="700"
                            >
                              {count}
                            </text>
                            <text
                              x={x}
                              y={y + 30}
                              textAnchor="middle"
                              fontSize="10"
                              fill="#333"
                              fontWeight="600"
                            >
                              {state}
                            </text>
                          </>
                        )}
                      </g>
                    );
                  })}
                </svg>
                {/* Active states summary */}
                {Object.keys(analytics.byState).length > 0 && (
                  <div style={{ 
                    marginTop: '12px', 
                    padding: '10px', 
                    background: '#f0f0f0', 
                    borderRadius: '6px',
                    fontSize: '12px'
                  }}>
                    <strong>Active States:</strong>{' '}
                    {Object.entries(analytics.byState).map(([state, count], idx) => (
                      <span key={state}>
                        <button
                          onClick={() => setSelectedState(selectedState === state ? null : state)}
                          style={{
                            background: selectedState === state ? '#c41e3a' : '#2d5a3d',
                            color: 'white',
                            border: 'none',
                            padding: '2px 8px',
                            borderRadius: '4px',
                            cursor: 'pointer',
                            margin: '2px',
                            fontSize: '11px'
                          }}
                        >
                          {state} ({count})
                        </button>
                      </span>
                    ))}
                  </div>
                )}
                <div style={{ display: 'flex', gap: '16px', marginTop: '8px', fontSize: '11px', color: '#666' }}>
                  <span style={{ display: 'flex', alignItems: 'center', gap: '4px' }}>
                    <span style={{ width: '8px', height: '8px', borderRadius: '50%', background: '#c41e3a' }} /> Selected
                  </span>
                  <span style={{ display: 'flex', alignItems: 'center', gap: '4px' }}>
                    <span style={{ width: '8px', height: '8px', borderRadius: '50%', background: '#2d5a3d' }} /> Active
                  </span>
                  <span style={{ display: 'flex', alignItems: 'center', gap: '4px' }}>
                    <span style={{ width: '8px', height: '8px', borderRadius: '50%', background: '#e0e0e0' }} /> No Activity
                  </span>
                </div>
              </div>

              {/* Email Subscribe */}
              <div style={{ marginBottom: '24px' }}>
                <h3 style={{ fontSize: '11px', textTransform: 'uppercase', letterSpacing: '1px', color: '#666', marginBottom: '12px', display: 'flex', alignItems: 'center', gap: '6px' }}>
                  <IconComponent name="Bell" /> Daily Digest
                </h3>
                <form onSubmit={handleSubscribe}>
                  <input
                    type="email"
                    placeholder="Enter email address"
                    value={email}
                    onChange={(e) => setEmail(e.target.value)}
                    style={{
                      width: '100%',
                      padding: '10px 12px',
                      border: '1px solid #ddd',
                      borderRadius: '6px',
                      fontSize: '14px',
                      marginBottom: '8px'
                    }}
                  />
                  <button
                    type="submit"
                    disabled={subscribeStatus === 'loading'}
                    style={{
                      width: '100%',
                      padding: '10px',
                      background: subscribeStatus === 'success' ? '#2d5a3d' : 'linear-gradient(135deg, #c9a962 0%, #d4b97a 100%)',
                      color: subscribeStatus === 'success' ? 'white' : '#1a2634',
                      border: 'none',
                      borderRadius: '6px',
                      cursor: 'pointer',
                      fontWeight: '600',
                      fontSize: '14px',
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'center',
                      gap: '6px'
                    }}
                  >
                    {subscribeStatus === 'loading' ? 'Subscribing...' : 
                     subscribeStatus === 'success' ? <><IconComponent name="Check" /> Subscribed!</> : 
                     'Subscribe'}
                  </button>
                </form>
                <p style={{ fontSize: '11px', color: '#999', marginTop: '8px', textAlign: 'center' }}>
                  Daily digest sent at 10:00 AM ET
                </p>
              </div>

              {/* Export */}
              <div style={{ marginBottom: '24px' }}>
                <h3 style={{ fontSize: '11px', textTransform: 'uppercase', letterSpacing: '1px', color: '#666', marginBottom: '12px', display: 'flex', alignItems: 'center', gap: '6px' }}>
                  <IconComponent name="Download" /> Export
                </h3>
                <button
                  onClick={downloadReport}
                  style={{
                    width: '100%',
                    padding: '10px',
                    background: 'white',
                    border: '1px solid #ddd',
                    borderRadius: '6px',
                    cursor: 'pointer',
                    fontSize: '13px',
                    marginBottom: '8px',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    gap: '8px'
                  }}
                >
                  ðŸ“„ Download Report
                </button>
                <button
                  onClick={exportCSV}
                  style={{
                    width: '100%',
                    padding: '10px',
                    background: 'white',
                    border: '1px solid #ddd',
                    borderRadius: '6px',
                    cursor: 'pointer',
                    fontSize: '13px',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    gap: '8px'
                  }}
                >
                  ðŸ“Š Export CSV
                </button>
              </div>

              {/* Contact */}
              <div style={{ 
                padding: '16px', 
                background: '#f9f9f9', 
                borderRadius: '6px',
                textAlign: 'center'
              }}>
                <p style={{ fontSize: '12px', color: '#666', margin: '0 0 8px 0' }}>
                  Want to add another source?
                </p>
                <a 
                  href="mailto:jessica.waverka@nortonrosefulbright.com"
                  style={{ 
                    color: '#c9a962', 
                    fontSize: '13px',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    gap: '6px'
                  }}
                >
                  <IconComponent name="Mail" /> Contact Jessica Waverka
                </a>
              </div>
            </aside>
          </div>

          {/* Footer */}
          <footer style={{
            background: '#1a2634',
            color: '#666',
            padding: '12px 24px',
            fontSize: '11px',
            display: 'flex',
            justifyContent: 'space-between',
            alignItems: 'center'
          }}>
            <span>Â© 2026 NRF US Financial Services Team | Data refreshed: {currentTime.toLocaleString()}</span>
            <span>CONFIDENTIAL</span>
          </footer>
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
